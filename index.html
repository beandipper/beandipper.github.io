<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen"/>
  <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>Beandipper.github.io</title>
  <meta name="description" content="source-maps">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Beandipper.github.io</h1>
    </header>
    <div id="container">
      <p class="tagline">source-maps</p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/beandipper" class="code">View Beandipper.github.io on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h3>
<a name="testing-out-source-maps-with-clojurescript" class="anchor" href="#testing-out-source-maps-with-clojurescript"><span class="octicon octicon-link"></span></a>Testing out source-maps with clojurescript</h3>

<p><img src="http://i.imgur.com/Lea1zjz.jpg?1" alt="Happy debugging!"></p>

<p>So I heard about getting source maps working with clojurescript and after asking around on #clojure seangrove was nice enough to help me out. I'm basically hijacking the gist that <a href="https://github.com/sgrove" class="user-mention">@sgrove</a> sent me so all credit is to him. This will get you up and running with clojurescript source-maps, but it is still a work in progress so don't expect it to be perfect. I believe the correct line reference may be off by one for example. </p>

<p>Using lein cljsbuild, lein will create a .map file which can be used after enabling source-map debugging in browsers. <a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/">Here is a good intro if you aren't really sure what source maps are about.</a>. Now to get started:</p>

<h3>
<a name="1-setup-your-projectclj" class="anchor" href="#1-setup-your-projectclj"><span class="octicon octicon-link"></span></a>1. Setup your project.clj</h3>

<p>Basically what you have to do here is to add the location where a source map is located with the option :source-map. You also need the :output-dir and :id options as well. Notice that the :optimizations are set to :simple as only works tested with :simple or :advanced compilation. Do not use :optimizations :whitespace. </p>

<pre><code>:cljsbuild {:test-commands {"unit-tests" ["runners/phantomjs.js"
                                        "resources/public/js/vendor/handlebars-1.0.rc.1.min.js"
                                        "resources/private/js/unit-test.js"]}
          :builds
          [{:source-paths ["src/cljs"],
            :id "dev",
            :compiler {:pretty-print true,
                       :output-dir "resources/public/js/bin-debug",
                       :output-to "resources/public/js/bin-debug/main.js",
                       :externs ["externs/jquery.js"
                                 "resources/externs/stripe.js"
                                 "resources/externs/handlebars.js"
                                 "resources/externs/misc.js"],
                       :optimizations :simple
                       :source-map "resources/public/js/bin-debug/main.js.map"
                       }}]}
</code></pre>

<p>Now run lein cljsbuild once dev and lein lein should produce your map where you specified.</p>

<h3>
<a name="2-edit-generated-javascript-file" class="anchor" href="#2-edit-generated-javascript-file"><span class="octicon octicon-link"></span></a>2. Edit generated javascript file</h3>

<p><em>Note: all files specified need to be available from the server</em></p>

<p>If lein compiled everything you should have the map(here: main.js.map) and an outputted javascript file(:output-to option from above). For now this file has to be edited by hand, changing the line at the bottom of the file to an address relative to the outputted js file like so:</p>

<p><code>//@ sourceMappingURL=/js/bin-debug/main.js.map.merged</code></p>

<p>This has to be done because resources/public/ is probably mounted at /</p>

<h3>
<a name="3-edit-the-generated-map-file" class="anchor" href="#3-edit-the-generated-map-file"><span class="octicon octicon-link"></span></a>3. Edit the generated map file</h3>

<p>The addresses in the main.js.map.merged file need to be changed similarly to the previous step so a relative path available on the server. </p>

<pre><code>{"version":3,
 "file":"resources/public/js/bin-debug/main.js.map",
 "sources":
 ["/Users/sgrove/src/example_clojure_app/src/cljs/settings/flow.cljs",...]
</code></pre>

<p>Open the file up and change the absolute paths to relative paths available from the front-end. If there are other paths pointing to jar files for example in maven repositories, you can ignore them.</p>

<h3>
<a name="4-copy-over-clojurescript-directories" class="anchor" href="#4-copy-over-clojurescript-directories"><span class="octicon octicon-link"></span></a>4. copy over clojurescript directories</h3>

<p>Finally, because the clojurescript files aren't available by the browser front-end we have to additionally copy them over to a public directory to make them publicly available like the previous steps. _Note: Do not do this for production as anybody can see your source!
Do a simple copy of your clojurescript directory structure like so:</p>

<p><code>cp -r src resources/public</code></p>

<p>Now after enabling source-map debugging in your browser(see link in beginning) you should see be able to debug and set breakpoints in your clojurescript code from the browsers debugger.  </p>

<p>Once again thanks to Sean Grove!. </p>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">

      <p><a href="https://github.com/beandipper" class="avatar"><img src="https://secure.gravatar.com/avatar/f72575e58192b43ba501b63076c2a7e4?s=30&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="48" height="48"/></a>View <a href="https://github.com/beandipper">beandipper</a> on <a href="https://www.github.com">GitHub</a></p>

      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br/>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/beandipper/beandipper.github.io/tarball/master" class="tar">tar</a><a href="https://github.com/beandipper/beandipper.github.io/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

  
</body>
</html>
